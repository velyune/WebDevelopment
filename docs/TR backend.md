# Техническое решение backend-сервисов на платформе .NET и базе данных PostgreSQL

---

## 1. Сервис аутентификации и авторизации

- **Платформа:** ASP.NET Core Identity с JWT аутентификацией
- **БД:** PostgreSQL для хранения пользователей, ролей и прав доступа через Entity Framework Core с провайдером Npgsql
- **Особенности:**
  - Использование OAuth 2.0 для безопасности
  - Два уровня аутентификации с поддержкой 2FA
  - Защита паролей через bcrypt
  - Использование Claims для разграничения доступа

## 2. Сервис управления заявками

- **Архитектура:** ASP.NET Core Web API
- **ORM:** Entity Framework Core с PostgreSQL для хранения данных заявок, статусов, логов изменений
- **Паттерны:** CQRS с MediatR для разделения чтения и записи
- **Особенности:**
  - REST API для CRUD операций
  - Использование RabbitMQ для обработки событий и уведомлений о статусах

## 3. Сервис загрузки и хранения файлов

- **Технология:** ASP.NET Core с интеграцией AWS S3 или Yandex Storage через SDK
- **Хранение:** Метаданные файлов и ссылки в PostgreSQL
- **Особенности:**
  - Поддержка версионности файлов
  - Предпросмотр PDF через интеграцию с фронтендом
  - Проверка безопасностии при загрузке (антивирус/валидация)

## 4. Сервис подписок и оплат

- **Интеграция:** Внешние платежные шлюзы (Yandex.Kassa, Stripe) через API ASP.NET Core
- **Хранение:** Подписки и платежные данные в PostgreSQL с отслеживанием статусов платежей
- **Особенности:**
  - Webhook для обработки статусов оплат
  - Автоматическое продление подписки на основе cron-задач или Azure Functions

## 5. Сервис формирования и выдачи отчетов

- **Генерация:** Использование библиотек PDFSharp или QuestPDF для создания PDF в .NET
- **Подпись:** Интеграция с сервисом ЭЦП, хранение сертификатов в безопасном хранилище
- **Хранение:** Метаданные и ссылки на отчеты в PostgreSQL

## 6. Коммуникационный сервис

- **Технологии:** ASP.NET Core + SignalR для real-time уведомлений
- **Интеграция:** Email через SMTP (SendGrid), SMS через Twilio или Яндекс.СМС
- **Особенности:** Логирование сообщений, настройка шаблонов уведомлений

## 7. Административный сервис

- **Функции:** Управление пользователями, тарифами, заказами с помощью Web API и административного UI
- **Безопасность:** RBAC, аудит изменений с записью в PostgreSQL
- **Отчетность:** Генерация статистики на основе данных в БД

## 8. Сервис безопасности и аудита

- **Функции:** Средства защиты от CSRF, XSS, DDOS с использованием встроенных возможностей ASP.NET Core
- **Логирование:** Централизованное в PostgreSQL и внешние системы, интеграция с Elastic Stack
- **Мониторинг:** Health checks и метрики с помощью Prometheus и Grafana

## 9. Интеграционный сервис

- **API:** REST и SOAP клиенты для взаимодействия с ЕИС нотариата, Росреестром
- **Технология:** ASP.NET Core HTTP Client Factory и Background Services для обработки асинхронных запросов
- **Логика:** Ретрай и кэширование данных в PostgreSQL/Redis

## 10. Сервис логирования и мониторинга

- **Стек:** Serilog для логирования в PostgreSQL и Elasticsearch
- **Мониторинг:** Интеграция с Prometheus и Grafana
- **Особенности:** Настраиваемые алерты на аномалии, удобные дашборды для админов

## 11. Сервис поддержки пользователей

- **Решение:** Интеграция с чат-ботом на базе Bot Framework и Zendesk API
- **Хранение:** Тикеты и обращения в PostgreSQL
- **Особенности:** Аналитика обращений и история взаимодействий

---

# Итог

Использование ASP.NET Core с PostgreSQL обеспечивает высокую производительность, масштабируемость и безопасность сервиса нотариальной оценки наследства. Архитектура с разделением ответственности через микросервисы и использование проверенных библиотек и паттернов (CQRS, MediatR) создаёт надёжную и легко поддерживаемую платформу.
